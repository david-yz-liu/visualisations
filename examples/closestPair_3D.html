<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Closest Pair - WebGL test</title>
    <style>
        .container {
            background: #FFFFFF;
            width: 800px;
            height: 800px;
        }
    </style>
    <!--[if lt IE 9]>
        <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
<body>
    <div class="container" style="float: left;"></div>
    <div class="menu" style="float: right;"></div>
    
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/three.js/r67/three.min.js"></script>
    
    <script type="text/javascript">
        var scripts = [
            "../js/visualisations.js",
            "js/helper.js",
            "js/closestPair.js",
        ];
        jQuery.noConflict();
        
        jQuery.each(scripts, function(i, script){
            jQuery.ajax({
                url: script,
                dataType: "script",
                async: false,
                complete: function(xhr, status){
                    eval(xhr);
                    console.log(status);
                },
            });
        });
        
        /* *** COMPUTATIONAL SECTION *** */
        var MAX_POINTS = 15;
        var SIZE = 10.0;
        /* --- Generate some random points and bounding box --- */
        var points = [];
        for(var i = 0;i < MAX_POINTS;i++){
            var vector = new THREE.Vector3(
                (Math.random() * 2 - 1) * SIZE,
                (Math.random() * 2 - 1) * SIZE,
                (Math.random() * 2 - 1) * SIZE
            );
            points.push(ClosestPair.vector2Mesh(vector));
        }
        var boundingBox = new THREE.Box3(
            new THREE.Vector3(-SIZE, -SIZE, 0.0),
            new THREE.Vector3( SIZE,  SIZE, 0.0)
        );
        /* --- Find closest points --- */
        var result = ClosestPair.findPair(points, boundingBox);
        
        /* --- Graphics --- */
        var g = visualisations.threeSetup(".container");
        /* --- Setup cube for rendering --- */
        var box = new THREE.Mesh(
            new THREE.BoxGeometry(SIZE * 2, SIZE * 2, SIZE * 2),
            new THREE.MeshBasicMaterial({
                color: 0x0000ff,
                transparent: true,
                opacity: 0.1})
        );
        g.scene.add(box);
        box.add(ClosestPair.minimumLines);
        jQuery.each(points, function(i, point){
            box.add(point);
        });
        
        /* --- Redraw function --- */
        function redraw(){
            console.log("redraw called");
            box.rotation.y += 0.01;
            g.renderer.render(g.scene, g.camera);
            helper.requestAnimationFrame(redraw);
        }
        redraw();
        
        /* --- Setup play buttons --- */
        var sButton = jQuery("<button/>");
        sButton.append("Single").on("click", function(e){
            ClosestPair.activity.executeSingle();
        });
        var cButton = jQuery("<button/>");
        cButton.append("Continous").on("click", function(e){
            ClosestPair.activity.executeContinous();
        });
        jQuery(".menu").append(sButton).append(cButton);
    </script>
</body>
</html>